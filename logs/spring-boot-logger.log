2025-03-21 00:00:10,025 INFO o.h.v.i.u.Version [background-preinit] HV000001: Hibernate Validator 8.0.1.Final
2025-03-21 00:00:10,043 INFO o.s.b.StartupInfoLogger [main] Starting TestGenerationIntegrationTest using Java 23.0.2 with PID 56406 (started by yari in /Users/yari/git/cursor-test-uat)
2025-03-21 00:00:10,044 DEBUG o.s.b.StartupInfoLogger [main] Running with Spring Boot v3.2.3, Spring v6.1.4
2025-03-21 00:00:10,045 INFO o.s.b.SpringApplication [main] No active profile set, falling back to 1 default profile: "default"
2025-03-21 00:00:10,447 INFO o.s.d.r.c.RepositoryConfigurationDelegate [main] Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-03-21 00:00:10,521 INFO o.s.d.r.c.RepositoryConfigurationDelegate [main] Finished Spring Data repository scanning in 69 ms. Found 5 JPA repository interfaces.
2025-03-21 00:00:10,775 INFO c.z.h.HikariDataSource [main] HikariPool-1 - Starting...
2025-03-21 00:00:10,996 INFO c.z.h.p.HikariPool [main] HikariPool-1 - Added connection org.sqlite.jdbc4.JDBC4Connection@5dae5a70
2025-03-21 00:00:10,997 INFO c.z.h.HikariDataSource [main] HikariPool-1 - Start completed.
2025-03-21 00:00:11,043 INFO o.f.c.i.l.s.Slf4jLog [main] Flyway Community Edition 9.22.3 by Redgate
2025-03-21 00:00:11,044 INFO o.f.c.i.l.s.Slf4jLog [main] See release notes here: https://rd.gt/416ObMi
2025-03-21 00:00:11,044 INFO o.f.c.i.l.s.Slf4jLog [main] 
2025-03-21 00:00:11,050 INFO o.f.c.i.l.s.Slf4jLog [main] Database: jdbc:sqlite:test_generation.db (SQLite 3.36)
2025-03-21 00:00:11,065 INFO o.f.c.i.l.s.Slf4jLog [main] Successfully validated 1 migration (execution time 00:00.006s)
2025-03-21 00:00:11,068 INFO o.f.c.i.l.s.Slf4jLog [main] Current version of schema "main": 1
2025-03-21 00:00:11,070 INFO o.f.c.i.l.s.Slf4jLog [main] Schema "main" is up to date. No migration necessary.
2025-03-21 00:00:11,108 INFO o.h.j.i.u.LogHelper [main] HHH000204: Processing PersistenceUnitInfo [name: default]
2025-03-21 00:00:11,136 INFO o.h.Version [main] HHH000412: Hibernate ORM core version 6.4.4.Final
2025-03-21 00:00:11,157 INFO o.h.c.i.RegionFactoryInitiator [main] HHH000026: Second-level cache disabled
2025-03-21 00:00:11,277 INFO o.s.o.j.p.SpringPersistenceUnitInfo [main] No LoadTimeWeaver setup: ignoring JPA class transformer
2025-03-21 00:00:11,788 INFO o.h.e.t.j.p.i.JtaPlatformInitiator [main] HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-03-21 00:00:11,802 DEBUG o.h.e.j.s.SqlStatementLogger [main] 
    alter table test_generation_jobs 
       add column components varchar(255)
2025-03-21 00:00:11,806 INFO o.s.o.j.AbstractEntityManagerFactoryBean [main] Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-03-21 00:00:12,135 INFO c.e.c.TestGenerationController [main] TestGenerationController initialized with TestGenerationService
2025-03-21 00:00:12,242 WARN o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration [main] spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-03-21 00:00:12,459 INFO o.s.m.w.MockServletContext [main] Initializing Spring TestDispatcherServlet ''
2025-03-21 00:00:12,460 INFO o.s.w.s.FrameworkServlet [main] Initializing Servlet ''
2025-03-21 00:00:12,461 INFO o.s.w.s.FrameworkServlet [main] Completed initialization in 0 ms
2025-03-21 00:00:12,491 INFO o.s.b.StartupInfoLogger [main] Started TestGenerationIntegrationTest in 2.719 seconds (process running for 3.207)
2025-03-21 00:00:12,881 INFO c.e.c.TestGenerationController [main] Starting asynchronous test generation for ticket:  with jobId: f9c06d15-ee08-4ad6-b2b1-460310c76001
2025-03-21 00:00:12,903 DEBUG o.h.e.j.s.SqlStatementLogger [TestGeneration-1] 
    /* insert for
        com.example.model.GenerationJob */insert 
    into
        generation_job (created_at, generated_test_id, status, ticket_content_id, timestamp, uid, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2025-03-21 00:00:12,907 INFO c.e.c.TestGenerationController [main] Starting asynchronous test generation for ticket: PROJ-123 with jobId: 8d6db53b-00fb-4cb8-b96c-b3a03740bfd1
2025-03-21 00:00:12,907 DEBUG o.h.e.j.s.SqlStatementLogger [TestGeneration-1] 
    select
        last_insert_rowid()
2025-03-21 00:00:12,909 DEBUG o.h.e.j.s.SqlStatementLogger [TestGeneration-2] 
    /* insert for
        com.example.model.GenerationJob */insert 
    into
        generation_job (created_at, generated_test_id, status, ticket_content_id, timestamp, uid, updated_at) 
    values
        (?, ?, ?, ?, ?, ?, ?)
2025-03-21 00:00:12,919 DEBUG o.h.e.j.s.SqlStatementLogger [TestGeneration-2] 
    select
        last_insert_rowid()
2025-03-21 00:00:12,928 INFO c.e.c.TestGenerationController [main] Checking status for jobId: 8d6db53b-00fb-4cb8-b96c-b3a03740bfd1
2025-03-21 00:00:12,934 DEBUG o.h.e.j.s.SqlStatementLogger [TestGeneration-1] 
    select
        gj1_0.id,
        gj1_0.created_at,
        gt1_0.id,
        gt1_0.attempts,
        gt1_0.created_at,
        gt1_0.test_content,
        gt1_0.uid,
        gt1_0.updated_at,
        gt1_0.validated,
        gj1_0.status,
        tc1_0.id,
        tc1_0.content,
        tc1_0.created_at,
        tc1_0.uid,
        tc1_0.updated_at,
        gj1_0.timestamp,
        gj1_0.uid,
        gj1_0.updated_at 
    from
        generation_job gj1_0 
    left join
        generated_test gt1_0 
            on gt1_0.id=gj1_0.generated_test_id 
    left join
        ticket_content tc1_0 
            on tc1_0.id=gj1_0.ticket_content_id 
    where
        gj1_0.id=?
2025-03-21 00:00:12,934 DEBUG o.h.e.j.s.SqlStatementLogger [TestGeneration-2] 
    select
        gj1_0.id,
        gj1_0.created_at,
        gt1_0.id,
        gt1_0.attempts,
        gt1_0.created_at,
        gt1_0.test_content,
        gt1_0.uid,
        gt1_0.updated_at,
        gt1_0.validated,
        gj1_0.status,
        tc1_0.id,
        tc1_0.content,
        tc1_0.created_at,
        tc1_0.uid,
        tc1_0.updated_at,
        gj1_0.timestamp,
        gj1_0.uid,
        gj1_0.updated_at 
    from
        generation_job gj1_0 
    left join
        generated_test gt1_0 
            on gt1_0.id=gj1_0.generated_test_id 
    left join
        ticket_content tc1_0 
            on tc1_0.id=gj1_0.ticket_content_id 
    where
        gj1_0.id=?
2025-03-21 00:00:12,938 DEBUG o.h.e.j.s.SqlStatementLogger [TestGeneration-2] 
    /* insert for
        com.example.model.TicketContent */insert 
    into
        ticket_content (content, created_at, uid, updated_at) 
    values
        (?, ?, ?, ?)
2025-03-21 00:00:12,938 DEBUG o.h.e.j.s.SqlStatementLogger [TestGeneration-1] 
    /* insert for
        com.example.model.TicketContent */insert 
    into
        ticket_content (content, created_at, uid, updated_at) 
    values
        (?, ?, ?, ?)
2025-03-21 00:00:12,939 DEBUG o.h.e.j.s.SqlStatementLogger [TestGeneration-2] 
    select
        last_insert_rowid()
2025-03-21 00:00:12,941 WARN o.h.e.j.s.SqlExceptionHelper [TestGeneration-1] SQL Error: 5, SQLState: null
2025-03-21 00:00:12,941 ERROR o.h.e.j.s.SqlExceptionHelper [TestGeneration-1] [SQLITE_BUSY]  The database file is locked (database is locked)
2025-03-21 00:00:12,944 DEBUG o.h.e.j.s.SqlStatementLogger [TestGeneration-2] 
    /* update
        for com.example.model.GenerationJob */update generation_job 
    set
        created_at=?,
        generated_test_id=?,
        status=?,
        ticket_content_id=?,
        timestamp=?,
        uid=?,
        updated_at=? 
    where
        id=?
2025-03-21 00:00:12,945 ERROR o.s.a.i.SimpleAsyncUncaughtExceptionHandler [TestGeneration-1] Unexpected exception occurred invoking async method: public void com.example.service.TestGenerationService.startTestGeneration(java.lang.String,com.example.dto.TicketContentDto)
org.springframework.dao.CannotAcquireLockException: could not execute statement [[SQLITE_BUSY]  The database file is locked (database is locked)] [/* insert for com.example.model.TicketContent */insert into ticket_content (content,created_at,uid,updated_at) values (?,?,?,?)]; SQL [/* insert for com.example.model.TicketContent */insert into ticket_content (content,created_at,uid,updated_at) values (?,?,?,?)]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:283)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:244)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.translateExceptionIfPossible(AbstractEntityManagerFactoryBean.java:550)
	at org.springframework.dao.support.ChainedPersistenceExceptionTranslator.translateExceptionIfPossible(ChainedPersistenceExceptionTranslator.java:61)
	at org.springframework.dao.support.DataAccessUtils.translateIfNecessary(DataAccessUtils.java:335)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:152)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:164)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:220)
	at jdk.proxy2/jdk.proxy2.$Proxy137.save(Unknown Source)
	at com.example.service.TestGenerationService.startTestGeneration(TestGenerationService.java:68)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:351)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1575)
Caused by: org.hibernate.exception.LockAcquisitionException: could not execute statement [[SQLITE_BUSY]  The database file is locked (database is locked)] [/* insert for com.example.model.TicketContent */insert into ticket_content (content,created_at,uid,updated_at) values (?,?,?,?)]
	at org.hibernate.community.dialect.SQLiteDialect.lambda$buildSQLExceptionConversionDelegate$1(SQLiteDialect.java:477)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.executeUpdate(ResultSetReturnImpl.java:197)
	at org.hibernate.id.insert.AbstractSelectingDelegate.performInsert(AbstractSelectingDelegate.java:77)
	at org.hibernate.engine.jdbc.mutation.internal.MutationExecutorPostInsertSingleTable.execute(MutationExecutorPostInsertSingleTable.java:100)
	at org.hibernate.persister.entity.mutation.InsertCoordinator.doStaticInserts(InsertCoordinator.java:175)
	at org.hibernate.persister.entity.mutation.InsertCoordinator.coordinateInsert(InsertCoordinator.java:113)
	at org.hibernate.persister.entity.AbstractEntityPersister.insert(AbstractEntityPersister.java:2868)
	at org.hibernate.action.internal.EntityIdentityInsertAction.execute(EntityIdentityInsertAction.java:81)
	at org.hibernate.engine.spi.ActionQueue.execute(ActionQueue.java:670)
	at org.hibernate.engine.spi.ActionQueue.addResolvedEntityInsertAction(ActionQueue.java:291)
	at org.hibernate.engine.spi.ActionQueue.addInsertAction(ActionQueue.java:272)
	at org.hibernate.engine.spi.ActionQueue.addAction(ActionQueue.java:322)
	at org.hibernate.event.internal.AbstractSaveEventListener.addInsertAction(AbstractSaveEventListener.java:386)
	at org.hibernate.event.internal.AbstractSaveEventListener.performSaveOrReplicate(AbstractSaveEventListener.java:300)
	at org.hibernate.event.internal.AbstractSaveEventListener.performSave(AbstractSaveEventListener.java:219)
	at org.hibernate.event.internal.AbstractSaveEventListener.saveWithGeneratedId(AbstractSaveEventListener.java:134)
	at org.hibernate.event.internal.DefaultMergeEventListener.saveTransientEntity(DefaultMergeEventListener.java:378)
	at org.hibernate.event.internal.DefaultMergeEventListener.entityIsTransient(DefaultMergeEventListener.java:298)
	at org.hibernate.event.internal.DefaultMergeEventListener.merge(DefaultMergeEventListener.java:211)
	at org.hibernate.event.internal.DefaultMergeEventListener.doMerge(DefaultMergeEventListener.java:146)
	at org.hibernate.event.internal.DefaultMergeEventListener.onMerge(DefaultMergeEventListener.java:130)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:138)
	at org.hibernate.internal.SessionImpl.fireMerge(SessionImpl.java:868)
	at org.hibernate.internal.SessionImpl.merge(SessionImpl.java:839)
	at org.hibernate.engine.spi.CascadingActions$6.cascade(CascadingActions.java:253)
	at org.hibernate.engine.spi.CascadingActions$6.cascade(CascadingActions.java:243)
	at org.hibernate.engine.internal.Cascade.cascadeToOne(Cascade.java:517)
	at org.hibernate.engine.internal.Cascade.cascadeAssociation(Cascade.java:439)
	at org.hibernate.engine.internal.Cascade.cascadeProperty(Cascade.java:224)
	at org.hibernate.engine.internal.Cascade.cascade(Cascade.java:157)
	at org.hibernate.event.internal.DefaultMergeEventListener.cascadeOnMerge(DefaultMergeEventListener.java:644)
	at org.hibernate.event.internal.DefaultMergeEventListener.entityIsDetached(DefaultMergeEventListener.java:426)
	at org.hibernate.event.internal.DefaultMergeEventListener.merge(DefaultMergeEventListener.java:208)
	at org.hibernate.event.internal.DefaultMergeEventListener.doMerge(DefaultMergeEventListener.java:146)
	at org.hibernate.event.internal.DefaultMergeEventListener.onMerge(DefaultMergeEventListener.java:130)
	at org.hibernate.event.internal.DefaultMergeEventListener.onMerge(DefaultMergeEventListener.java:84)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:127)
	at org.hibernate.internal.SessionImpl.fireMerge(SessionImpl.java:847)
	at org.hibernate.internal.SessionImpl.merge(SessionImpl.java:833)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:319)
	at jdk.proxy2/jdk.proxy2.$Proxy133.merge(Unknown Source)
	at org.springframework.data.jpa.repository.support.SimpleJpaRepository.save(SimpleJpaRepository.java:621)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:351)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker$RepositoryFragmentMethodInvoker.lambda$new$0(RepositoryMethodInvoker.java:277)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158)
	at org.springframework.data.repository.core.support.RepositoryComposition$RepositoryFragments.invoke(RepositoryComposition.java:516)
	at org.springframework.data.repository.core.support.RepositoryComposition.invoke(RepositoryComposition.java:285)
	at org.springframework.data.repository.core.support.RepositoryFactorySupport$ImplementationMethodExecutionInterceptor.invoke(RepositoryFactorySupport.java:628)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:168)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:143)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	... 19 common frames omitted
Caused by: org.sqlite.SQLiteException: [SQLITE_BUSY]  The database file is locked (database is locked)
	at org.sqlite.core.DB.newSQLException(DB.java:1030)
	at org.sqlite.core.DB.newSQLException(DB.java:1042)
	at org.sqlite.core.DB.execute(DB.java:881)
	at org.sqlite.core.DB.executeUpdate(DB.java:922)
	at org.sqlite.jdbc3.JDBC3PreparedStatement.executeUpdate(JDBC3PreparedStatement.java:98)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java)
	at org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.executeUpdate(ResultSetReturnImpl.java:194)
	... 81 common frames omitted
2025-03-21 00:00:12,946 DEBUG o.h.e.j.s.SqlStatementLogger [TestGeneration-2] 
    /* insert for
        com.example.model.OperationLog */insert 
    into
        operation_log (created_at, job_uid, operation, timestamp, uid) 
    values
        (?, ?, ?, ?, ?)
2025-03-21 00:00:12,947 DEBUG o.h.e.j.s.SqlStatementLogger [TestGeneration-2] 
    select
        last_insert_rowid()
2025-03-21 00:00:12,948 DEBUG c.e.s.TestGenerationService [TestGeneration-2] Starting ticket analysis for jobId: 8d6db53b-00fb-4cb8-b96c-b3a03740bfd1
2025-03-21 00:00:12,948 INFO c.e.a.TicketAnalyzerAgent [TestGeneration-2] Starting ticket analysis for ticket: PROJ-123 in project: null
2025-03-21 00:00:12,948 DEBUG c.e.a.TicketAnalyzerAgent [TestGeneration-2] Analyzing ticket content: Implementare la funzionalità di login
2025-03-21 00:00:12,975 DEBUG o.h.e.j.s.SqlStatementLogger [main] 
    /* <criteria> */ select
        gj1_0.id,
        gj1_0.created_at,
        gj1_0.generated_test_id,
        gj1_0.status,
        gj1_0.ticket_content_id,
        gj1_0.timestamp,
        gj1_0.uid,
        gj1_0.updated_at 
    from
        generation_job gj1_0 
    where
        gj1_0.uid=?
2025-03-21 00:00:12,981 INFO c.e.c.TestGenerationController [main] Checking status for jobId: non-existent-job-id
2025-03-21 00:00:12,984 DEBUG o.h.e.j.s.SqlStatementLogger [main] 
    /* <criteria> */ select
        gj1_0.id,
        gj1_0.created_at,
        gj1_0.generated_test_id,
        gj1_0.status,
        gj1_0.ticket_content_id,
        gj1_0.timestamp,
        gj1_0.uid,
        gj1_0.updated_at 
    from
        generation_job gj1_0 
    where
        gj1_0.uid=?
2025-03-21 00:00:35,015 DEBUG c.e.a.TicketAnalyzerAgent [TestGeneration-2] Performing detailed ticket analysis
2025-03-21 00:00:43,023 INFO o.s.c.s.DefaultLifecycleProcessor$LifecycleGroup [SpringApplicationShutdownHook] Shutdown phase 2147483647 ends with 1 bean still running after timeout of 30000ms: [taskExecutor]
